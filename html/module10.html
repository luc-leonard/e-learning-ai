<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Module 10 â€” Les mots du mÃ©tier</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ—ï¸</text></svg>">
</head>
<body>
  <div class="app">
    <div id="sidebar-root"></div>
    <main class="main-content">
      <div class="module-content">

<h1>Module 10 : Les mots du mÃ©tier</h1>
<p class="module-subtitle"><em>Quand le code parle comme un dÃ©veloppeur alors qu'il devrait parler comme vos utilisateurs</em></p>
<hr>
<h2>Ce que vous savez dÃ©jÃ </h2>
<p>Vos modules sont dÃ©coupÃ©s. Ils communiquent par Ã©vÃ©nements. L'extÃ©rieur est propre. Mais ouvrez le capot d'un contexte â€” disons RÃ©unions â€” et regardez Ã  l'intÃ©rieur. C'est un sac de fonctions, de tables de base de donnÃ©es, et de champs aux noms techniques. Le bazar a juste dÃ©mÃ©nagÃ©.</p>
<p>Ce module va changer votre faÃ§on de penser. Pas votre code â€” votre faÃ§on de penser.</p>
<div class="module-meta">
<div class="module-meta-item"><strong>DurÃ©e :</strong> Une semaine (1-2 heures par jour)</div>
<div class="module-meta-item"><strong>Ce qu'il vous faut :</strong> Votre projet du Module 9, un compte Claude, votre carnet</div>
</div>
<hr>
<h2 id="m10-analogie">Avant de commencer : une analogie</h2>
<p>Vous Ãªtes le nouveau gÃ©rant d'un club de lecture. Le gÃ©rant prÃ©cÃ©dent vous a laissÃ© un classeur pour tout gÃ©rer. Vous l'ouvrez et vous trouvez :</p>
<pre><code>Table 1 : entitÃ©s
  id | type   | nom              | parent_id | status | data
  1  | event  | SoirÃ©e Polar     | null      | active | {"max":20}
  2  | user   | Marie Dupont     | null      | active | {"role":"member"}
  3  | reg    | null             | null      | done   | {"event":1,"user":2}
  4  | review | null             | null      | pub    | {"event":1,"user":2,"text":"..."}</code></pre>
<p>Vous comprenez quelque chose ? Tout est une "entitÃ©" avec un "type", un "status", et un blob de "data". C'est techniquement exact â€” mais c'est incomprÃ©hensible pour quelqu'un qui gÃ¨re un club de lecture.</p>
<p>Maintenant imaginez que l'ancien gÃ©rant vous avait plutÃ´t laissÃ© Ã§a :</p>
<pre><code>RÃ©unions Ã  venir :
  "SoirÃ©e Polar" â€” 15 mars, 20h, CafÃ© du Commerce
    Places : 17/20
    Inscrits : Marie Dupont, Jean Martin, ...

Membres :
  Marie Dupont â€” membre depuis janvier 2025
    A lu : 12 livres
    Prochain emprunt possible : oui (2/3 emprunts utilisÃ©s)

Livres en cours :
  "Le Nom de la Rose" â€” proposÃ© par Jean, 8 votes
    CatÃ©gorie : polar historique
    Exemplaires disponibles au prÃªt : 2</code></pre>
<p>C'est le mÃªme club. Les mÃªmes informations. Mais la deuxiÃ¨me version <strong>parle comme le gÃ©rant du club</strong>, pas comme un technicien. Vous savez immÃ©diatement ce qu'est une "rÃ©union Ã  venir", un "membre", un "exemplaire disponible au prÃªt".</p>
<p>Votre code, en ce moment, ressemble au premier classeur. Ce module va le transformer en deuxiÃ¨me classeur.</p>
<hr>
<div class="step-header" id="m10-jour1"><span class="step-number">1</span><h2>Ã‰couter les utilisateurs <small style="font-weight:400;font-size:0.65em;color:var(--text-tertiary)">(90 min)</small></h2></div>
<h3>Ce que vous allez faire</h3>
<p>Pas de code aujourd'hui. Aujourd'hui, vous allez <strong>Ã©couter</strong>.</p>
<p>Imaginez que vous Ãªtes dans le vrai club de lecture. Le gÃ©rant, les membres, l'admin â€” comment parlent-ils de ce qui se passe ? Pas en termes de code. En termes de leur quotidien.</p>
<p>Demandez Ã  Claude :</p>
<blockquote>
<p>Je construis une application pour un club de lecture. Je veux lister tous les mots et expressions qu'utiliserait un vrai gÃ©rant de club de lecture pour parler de son activitÃ©. Pas des mots techniques â€” les mots de tous les jours.</p>
<p>Organise-les par thÃ¨me. Par exemple :</p>
<ul>
<li>Comment parle-t-il des rÃ©unions ? (pas des "events" ou des "entities")</li>
<li>Comment parle-t-il des membres ? (pas des "users" ou des "accounts")</li>
<li>Comment parle-t-il des livres qu'on se prÃªte ?</li>
</ul>
<p>Pour chaque mot, donne une phrase d'exemple comme un gÃ©rant la dirait dans la vraie vie.</p>
</blockquote>
<h3>Ce que Claude va vous donner</h3>
<p>Quelque chose comme :</p>
<pre><code>COMMENT LE GÃ‰RANT PARLE DES RÃ‰UNIONS :

"La prochaine sÃ©ance est mardi."
â†’ sÃ©ance (pas "event", pas "meeting entity")

"Il reste 3 places pour la sÃ©ance polar."
â†’ places restantes (pas "available_slots", pas "capacity minus count")

"Marie s'est inscrite mais elle est sur liste d'attente."
â†’ liste d'attente (pas "waitlist_queue", pas "status: pending")

"On a dÃ» annuler la sÃ©ance, j'ai prÃ©venu tout le monde."
â†’ annuler, prÃ©venir (pas "soft delete", pas "trigger notification pipeline")

COMMENT IL PARLE DES LIVRES :

"Jean a proposÃ© 'Le Nom de la Rose' pour le mois prochain."
â†’ proposer un livre (pas "create book entry")

"On a votÃ©, c'est le polar qui l'a emportÃ©."
â†’ voter, l'emporter (pas "increment vote count", pas "select max")

"Marie a un exemplaire, elle le prÃªte Ã  Jean."
â†’ exemplaire, prÃªter (pas "book instance", pas "create loan record")

"Jean devait rendre le livre il y a deux semaines, je vais le relancer."
â†’ rendre, relancer (pas "update loan status", pas "send overdue notification")

COMMENT IL PARLE DES MEMBRES :

"Marie est une habituÃ©e, elle vient depuis le dÃ©but."
â†’ habituÃ©e (pas "user with created_at &lt; threshold")

"Jean est nouveau, c'est sa deuxiÃ¨me sÃ©ance."
â†’ nouveau membre (pas "user where session_count &lt;= 2")

"Paul a Ã©tÃ© un peu pÃ©nible, on l'a exclu du club."
â†’ exclure (pas "ban", pas "set status: banned")</code></pre>
<h3>Pourquoi c'est important</h3>
<p>Regardez la diffÃ©rence entre les deux colonnes. Ã€ gauche, des mots que tout le monde comprend. Ã€ droite, des mots de dÃ©veloppeur que seul le code comprend.</p>
<p>Votre code est rempli de mots de droite. Et c'est un problÃ¨me, parce que :</p>
<ol>
<li>
<p><strong>Vous ne comprenez pas votre propre code.</strong> Quand vous lisez <code>update_entity_status</code>, vous devez rÃ©flÃ©chir pour savoir si c'est "annuler une sÃ©ance" ou "exclure un membre" ou autre chose.</p>
</li>
<li>
<p><strong>Claude ne comprend pas votre intention.</strong> Quand vous dites "gÃ¨re l'annulation", Claude ne sait pas si vous parlez de l'annulation d'une sÃ©ance, d'une inscription, d'un prÃªt, ou d'un paiement â€” parce que dans le code, tout s'appelle <code>cancel</code>.</p>
</li>
<li>
<p><strong>Les bugs se cachent dans le flou.</strong> Si une fonction s'appelle <code>process_event</code>, elle peut faire n'importe quoi. Si elle s'appelle <code>annuler_seance_et_rembourser_inscrits</code>, il est beaucoup plus facile de vÃ©rifier qu'elle fait bien ce qu'elle dit.</p>
</li>
</ol>
<h3>L'exercice</h3>
<p>Prenez la liste de mots du gÃ©rant et collez-la dans votre carnet. C'est votre <strong>dictionnaire du domaine</strong>. Ã€ partir de maintenant, votre code doit utiliser CES mots, pas des mots techniques.</p>
<hr>
<div class="step-header" id="m10-jour2"><span class="step-number">2</span><h2>Regarder le code avec les yeux du gÃ©rant <small style="font-weight:400;font-size:0.65em;color:var(--text-tertiary)">(90 min)</small></h2></div>
<h3>Ce que vous allez faire</h3>
<p>Ouvrez votre contexte RÃ©unions et demandez Ã  Claude :</p>
<blockquote>
<p>Voici le code de mon contexte RÃ©unions :
[collez le code]</p>
<p>Et voici le dictionnaire des mots qu'utilise un vrai gÃ©rant de club de lecture :
[collez le dictionnaire du Jour 1]</p>
<p>Compare les deux. Pour chaque fonction et chaque champ de donnÃ©es, dis-moi :</p>
<ul>
<li>Le nom actuel dans le code</li>
<li>Ce que le gÃ©rant appellerait Ã§a</li>
<li>Si c'est diffÃ©rent (et Ã§a le sera souvent)</li>
</ul>
</blockquote>
<div class="callout callout-red">
<div class="callout-title">ğŸ”´ Ce que vous allez dÃ©couvrir</div>
<p>Le dÃ©calage est brutal. Exemples typiques :</p>
<table>
<thead>
<tr>
<th>Dans le code</th>
<th>Le gÃ©rant dit</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Event</code></td>
<td><strong>SÃ©ance</strong></td>
</tr>
<tr>
<td><code>create_event</code></td>
<td><strong>Programmer une sÃ©ance</strong></td>
</tr>
<tr>
<td><code>Registration</code></td>
<td><strong>Inscription</strong></td>
</tr>
<tr>
<td><code>cancel_registration</code></td>
<td><strong>Se dÃ©sinscrire</strong></td>
</tr>
<tr>
<td><code>status: "cancelled"</code></td>
<td><strong>SÃ©ance annulÃ©e</strong></td>
</tr>
<tr>
<td><code>max_attendees</code></td>
<td><strong>Nombre de places</strong></td>
</tr>
<tr>
<td><code>user</code></td>
<td><strong>Membre</strong></td>
</tr>
<tr>
<td><code>book_instance</code></td>
<td><strong>Exemplaire</strong></td>
</tr>
<tr>
<td><code>loan</code></td>
<td><strong>PrÃªt</strong> (ou <strong>emprunt</strong> selon le point de vue)</td>
</tr>
<tr>
<td><code>notification</code></td>
<td><strong>Message</strong> (ou <strong>rappel</strong>, ou <strong>confirmation</strong> â€” ce n'est pas la mÃªme chose !)</td>
</tr>
</tbody>
</table>
<p>Ce dernier point est crucial. Votre code a probablement un concept unique de "notification". Mais le gÃ©rant fait la diffÃ©rence entre une <strong>confirmation</strong> ("vous Ãªtes inscrit"), un <strong>rappel</strong> ("la sÃ©ance est demain"), et une <strong>alerte</strong> ("la sÃ©ance est annulÃ©e"). Ce sont trois choses diffÃ©rentes dans la vraie vie, mais une seule dans le code. C'est une source de bugs et de confusion.</p>
<h3>Ce que vous devez noter dans votre carnet</h3>
<blockquote class="notebook-prompt">
<p>âœï¸ Combien de noms dans le code ne correspondent pas aux mots du gÃ©rant ?
âœï¸ Y a-t-il des concepts dans le vocabulaire du gÃ©rant qui n'existent pas du tout dans le code ?
âœï¸ Y a-t-il des concepts dans le code qui n'ont aucun Ã©quivalent dans le vocabulaire du gÃ©rant ? (Si oui, demandez-vous s'ils devraient exister.)</p>
</blockquote>
</div>
<hr>
<div class="step-header" id="m10-jour3"><span class="step-number">3</span><h2>Les choses qui vont ensemble <small style="font-weight:400;font-size:0.65em;color:var(--text-tertiary)">(2h)</small></h2></div>
<h3>L'idÃ©e clÃ©</h3>
<p>Dans votre base de donnÃ©es, tout est Ã  plat. Vous avez une table de sÃ©ances, une table de membres, une table d'inscriptions, une table de paiements. Chaque table est indÃ©pendante, reliÃ©e aux autres par des numÃ©ros.</p>
<p>Mais dans la vraie vie, les choses ne sont pas Ã  plat. Elles forment des <strong>grappes</strong>.</p>
<p>Quand le gÃ©rant pense Ã  une sÃ©ance, il ne pense pas Ã  une ligne dans une table. Il pense Ã  un <strong>ensemble</strong> :</p>
<pre><code>La SoirÃ©e Polar
â”œâ”€â”€ 15 mars, 20h, CafÃ© du Commerce
â”œâ”€â”€ 20 places, dont 17 prises
â”œâ”€â”€ Inscrits :
â”‚   â”œâ”€â”€ Marie Dupont (inscrite le 2 mars, payÃ© 5â‚¬)
â”‚   â”œâ”€â”€ Jean Martin (inscrit le 5 mars, payÃ© 5â‚¬)
â”‚   â””â”€â”€ Paul Durand (liste d'attente depuis le 8 mars)
â”œâ”€â”€ Livre discutÃ© : "Le Nom de la Rose"
â””â”€â”€ Statut : confirmÃ©e</code></pre>
<p>C'est un <strong>tout</strong>. Vous n'inscrivez pas quelqu'un "dans la table inscriptions" â€” vous inscrivez quelqu'un <strong>Ã  la SoirÃ©e Polar</strong>. L'inscription n'a aucun sens sans la sÃ©ance. Le paiement n'a aucun sens sans l'inscription. C'est une grappe.</p>
<p>Et cette grappe a des <strong>rÃ¨gles qui s'appliquent Ã  l'ensemble</strong> :</p>
<ul>
<li>Le nombre d'inscrits ne dÃ©passe jamais le nombre de places â†’ c'est un invariant de LA GRAPPE, pas d'une table</li>
<li>On ne peut pas s'inscrire deux fois â†’ c'est une rÃ¨gle de LA GRAPPE</li>
<li>Quand la sÃ©ance est annulÃ©e, TOUS les inscrits sont remboursÃ©s â†’ c'est une action sur LA GRAPPE</li>
</ul>
<h3>Ce que vous allez faire</h3>
<p>Demandez Ã  Claude :</p>
<blockquote>
<p>Voici le dictionnaire de mon domaine et le code de mon contexte RÃ©unions :
[collez les deux]</p>
<p>Identifie les "grappes" â€” les choses qui vont ensemble et qui n'ont pas de sens sÃ©parÃ©ment. Pour chaque grappe :</p>
<ol>
<li>Quelle est la chose principale ? (la "racine")</li>
<li>Quelles sont les choses qui lui sont rattachÃ©es ?</li>
<li>Quels invariants s'appliquent Ã  la grappe entiÃ¨re ?</li>
<li>Quelles actions modifient la grappe ?</li>
</ol>
</blockquote>
<h3>Ce que Claude va vous montrer</h3>
<pre><code>GRAPPE : SÃ©ance
  Racine : la sÃ©ance elle-mÃªme (date, lieu, nombre de places)
  RattachÃ©s :
    - Les inscriptions (qui est inscrit, quand, statut du paiement)
    - La liste d'attente (qui attend, dans quel ordre)
  Invariants :
    - nombre d'inscrits â‰¤ nombre de places
    - un membre ne peut pas Ãªtre inscrit ET en liste d'attente
    - une sÃ©ance annulÃ©e n'accepte plus d'inscriptions
  Actions :
    - Programmer une sÃ©ance
    - Inscrire un membre (crÃ©e une inscription DANS la sÃ©ance)
    - Annuler la sÃ©ance (affecte TOUTES les inscriptions)
    - Passer de la liste d'attente Ã  inscrit (quand une place se libÃ¨re)

GRAPPE : PrÃªt
  Racine : le prÃªt (qui prÃªte, qui emprunte, quel exemplaire)
  RattachÃ©s :
    - L'Ã©tat du prÃªt (en cours, rendu, en retard)
    - Les relances (dates, messages envoyÃ©s)
  Invariants :
    - un exemplaire ne peut Ãªtre dans qu'un seul prÃªt actif
    - un prÃªt a toujours un prÃªteur ET un emprunteur
  Actions :
    - Demander un emprunt
    - Accepter / refuser
    - Signaler le retour
    - Relancer l'emprunteur</code></pre>
<h3>Le mot pour Ã§a</h3>
<p>Ces grappes, dans le vocabulaire professionnel, s'appellent des <strong>agrÃ©gats</strong> (Aggregates). La chose principale s'appelle la <strong>racine de l'agrÃ©gat</strong> (Aggregate Root).</p>
<p>La rÃ¨gle d'or : <strong>toute modification passe par la racine</strong>. On n'inscrit pas quelqu'un en modifiant directement la table des inscriptions â€” on demande Ã  la sÃ©ance d'inscrire quelqu'un. C'est la sÃ©ance qui vÃ©rifie les invariants (reste-t-il des places ?), pas l'inscription.</p>
<p>C'est exactement comme dans une entreprise : vous ne modifiez pas directement la fiche de paie d'un employÃ© â€” vous passez par les RH qui vÃ©rifient que tout est conforme.</p>
<hr>
<div class="step-header" id="m10-jour4"><span class="step-number">4</span><h2>Les choses qui ont une valeur, pas une identitÃ© <small style="font-weight:400;font-size:0.65em;color:var(--text-tertiary)">(90 min)</small></h2></div>
<h3>Un concept subtil mais important</h3>
<p>Dans votre club de lecture, il y a deux types de choses :</p>
<p><strong>Des choses qu'on identifie par QUI elles sont :</strong></p>
<ul>
<li>Marie Dupont est Marie Dupont. Si deux personnes s'appellent Marie Dupont, ce sont quand mÃªme deux personnes diffÃ©rentes. C'est l'<strong>identitÃ©</strong> qui compte.</li>
<li>La SoirÃ©e Polar du 15 mars est unique. MÃªme si vous crÃ©ez une autre soirÃ©e polar, ce n'est pas la mÃªme.</li>
</ul>
<p><strong>Des choses qu'on identifie par CE QU'ELLES CONTIENNENT :</strong></p>
<ul>
<li>Une adresse "12 rue des Lilas, Paris". Si deux sÃ©ances ont lieu Ã  la mÃªme adresse, c'est la mÃªme adresse. Pas deux adresses diffÃ©rentes qui se ressemblent â€” la mÃªme.</li>
<li>Un crÃ©neau horaire "mardi 20h-22h". Un crÃ©neau est dÃ©fini par son contenu, pas par un numÃ©ro d'identitÃ©.</li>
<li>Un montant "5â‚¬". Cinq euros, c'est cinq euros. Il n'y a pas "ce 5â‚¬-ci" et "ce 5â‚¬-lÃ ".</li>
</ul>
<p>Les premiÃ¨res sont des <strong>entitÃ©s</strong> â€” elles ont une identitÃ© propre.
Les secondes sont des <strong>objets-valeur</strong> (Value Objects) â€” elles sont dÃ©finies par leur contenu.</p>
<h3>Pourquoi Ã§a compte</h3>
<p>Dans votre code, probablement tout est une entitÃ©. L'adresse d'une sÃ©ance est stockÃ©e comme des champs sÃ©parÃ©s (<code>rue</code>, <code>ville</code>, <code>code_postal</code>) directement dans la table des sÃ©ances. Le crÃ©neau horaire est juste un <code>datetime</code>. Le montant est un nombre.</p>
<p>Le problÃ¨me :</p>
<pre data-lang="elixir"><code># Dans le code actuel :
seance.adresse_rue    # "12 rue des Lilas"
seance.adresse_ville  # "Paris"
seance.adresse_cp     # "75010"

# Que se passe-t-il si on veut vÃ©rifier que deux sÃ©ances
# sont au mÃªme endroit ?
seance1.adresse_rue == seance2.adresse_rue and
seance1.adresse_ville == seance2.adresse_ville and
seance1.adresse_cp == seance2.adresse_cp
# C'est fragile et moche.</code></pre>
<p>Avec un objet-valeur :</p>
<pre data-lang="elixir"><code># Avec un objet-valeur Adresse :
defmodule MonClub.Adresse do
  defstruct [:rue, :ville, :code_postal]
end

seance.lieu  # %Adresse{rue: "12 rue des Lilas", ville: "Paris", code_postal: "75010"}

# Deux sÃ©ances au mÃªme endroit ?
seance1.lieu == seance2.lieu
# Simple et clair.</code></pre>
<h3>Ce que vous allez faire</h3>
<p>Demandez Ã  Claude :</p>
<blockquote>
<p>Voici le code de mes contextes :
[collez le code]</p>
<p>Identifie les choses qui sont des objets-valeur dÃ©guisÃ©s â€” des donnÃ©es qui sont dÃ©finies par leur contenu, pas par une identitÃ© unique. Pour chacune :</p>
<ol>
<li>OÃ¹ est-elle Ã©parpillÃ©e en champs sÃ©parÃ©s dans le code ?</li>
<li>Quel objet-valeur pourrait la regrouper ?</li>
<li>Quel nom en langage du gÃ©rant ?</li>
</ol>
</blockquote>
<h3>Exemples courants</h3>
<p>Claude va probablement trouver :</p>
<table>
<thead>
<tr>
<th>Champs Ã©parpillÃ©s</th>
<th>Objet-valeur</th>
<th>Nom du gÃ©rant</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>rue</code>, <code>ville</code>, <code>cp</code></td>
<td><code>Adresse</code></td>
<td>"L'adresse de la sÃ©ance"</td>
</tr>
<tr>
<td><code>date</code>, <code>heure_debut</code>, <code>heure_fin</code></td>
<td><code>Creneau</code></td>
<td>"Le crÃ©neau de la sÃ©ance"</td>
</tr>
<tr>
<td><code>montant</code>, <code>devise</code></td>
<td><code>Montant</code></td>
<td>"Le prix de la sÃ©ance"</td>
</tr>
<tr>
<td><code>prenom</code>, <code>nom</code>, <code>email</code></td>
<td><code>Coordonnees</code></td>
<td>"Les coordonnÃ©es du membre"</td>
</tr>
<tr>
<td><code>debut_pret</code>, <code>duree_max</code></td>
<td><code>PeriodeDePret</code></td>
<td>"La durÃ©e du prÃªt"</td>
</tr>
</tbody>
</table>
<p>Transformez-en au moins deux ou trois. Demandez Ã  Claude de crÃ©er les structs Elixir et de mettre Ã  jour les contextes concernÃ©s.</p>
<hr>
<div class="step-header" id="m10-jour5"><span class="step-number">5</span><h2>RÃ©Ã©crire le code en langage du domaine <small style="font-weight:400;font-size:0.65em;color:var(--text-tertiary)">(2h)</small></h2></div>
<h3>Ce que vous allez faire</h3>
<p>Vous avez maintenant trois outils :</p>
<ol>
<li>Le <strong>dictionnaire du domaine</strong> (Jour 1) â€” les mots du gÃ©rant</li>
<li>Les <strong>agrÃ©gats</strong> (Jour 3) â€” les grappes de choses qui vont ensemble</li>
<li>Les <strong>objets-valeur</strong> (Jour 4) â€” les choses dÃ©finies par leur contenu</li>
</ol>
<p>Vous allez rÃ©Ã©crire votre contexte RÃ©unions en utilisant tout Ã§a.</p>
<p>Demandez Ã  Claude :</p>
<blockquote>
<p>Voici le code actuel de mon contexte RÃ©unions :
[collez le code]</p>
<p>Voici mon dictionnaire du domaine :
[collez le dictionnaire]</p>
<p>Voici les agrÃ©gats identifiÃ©s :
[collez les agrÃ©gats du Jour 3]</p>
<p>Voici les objets-valeur identifiÃ©s :
[collez les objets-valeur du Jour 4]</p>
<p>RÃ©Ã©cris le contexte RÃ©unions pour que :</p>
<ol>
<li>Les noms de fonctions utilisent le vocabulaire du gÃ©rant</li>
<li>L'agrÃ©gat SÃ©ance soit la racine â€” toute modification passe par la sÃ©ance</li>
<li>Les objets-valeur soient utilisÃ©s au lieu de champs Ã©parpillÃ©s</li>
<li>Les invariants de l'agrÃ©gat soient vÃ©rifiÃ©s dans la racine, pas ailleurs</li>
</ol>
</blockquote>
<h3>Ce que le code va devenir</h3>
<p>Avant :</p>
<pre data-lang="elixir"><code>defmodule MonClub.Reunions do
  def create_event(params) do ... end
  def register_user(event_id, user_id) do ... end
  def cancel_registration(reg_id) do ... end
  def update_event_status(event_id, status) do ... end
end</code></pre>
<p>AprÃ¨s :</p>
<pre data-lang="elixir"><code>defmodule MonClub.Reunions do
  def programmer_seance(titre, %Creneau{} = creneau, %Adresse{} = lieu, nombre_de_places) do
    # CrÃ©e une sÃ©ance avec ses paramÃ¨tres
  end

  def inscrire_membre(seance_id, membre_id) do
    # Charge la sÃ©ance (l'agrÃ©gat entier)
    # VÃ©rifie l'invariant : reste-t-il des places ?
    # VÃ©rifie l'invariant : le membre n'est-il pas dÃ©jÃ  inscrit ?
    # Ajoute l'inscription DANS la sÃ©ance
    # Publie {:membre_inscrit, ...}
  end

  def desinscrire_membre(seance_id, membre_id) do
    # Charge la sÃ©ance
    # Retire l'inscription
    # S'il y a une liste d'attente, passe le suivant en inscrit
    # Publie {:membre_desinscrit, ...}
  end

  def annuler_seance(seance_id, raison) do
    # Charge la sÃ©ance avec TOUS ses inscrits
    # Marque tout comme annulÃ©
    # Publie {:seance_annulee, %{inscrits: [...], raison: raison}}
  end
end</code></pre>
<h3>Ce que vous devez remarquer</h3>
<ol>
<li>
<p><strong>Les noms des fonctions sont du franÃ§ais du gÃ©rant.</strong> <code>programmer_seance</code>, <code>inscrire_membre</code>, <code>annuler_seance</code> â€” le gÃ©rant comprend ce code sans explication.</p>
</li>
<li>
<p><strong>Tout passe par la sÃ©ance.</strong> On ne modifie pas une inscription directement. On demande Ã  la sÃ©ance d'inscrire quelqu'un. La sÃ©ance vÃ©rifie ses invariants.</p>
</li>
<li>
<p><strong>Les objets-valeur sont explicites.</strong> <code>%Creneau{}</code>, <code>%Adresse{}</code> â€” ce ne sont pas des champs flottants, ce sont des concepts nommÃ©s.</p>
</li>
<li>
<p><strong>Les Ã©vÃ©nements aussi parlent le langage du domaine.</strong> <code>{:membre_inscrit}</code>, <code>{:seance_annulee}</code> â€” pas <code>{:registration_created}</code>, <code>{:event_status_updated}</code>.</p>
</li>
</ol>
<hr>
<div class="step-header" id="m10-jour6"><span class="step-number">6</span><h2>VÃ©rifier que tout tient <small style="font-weight:400;font-size:0.65em;color:var(--text-tertiary)">(90 min)</small></h2></div>
<h3>Ce que vous allez faire</h3>
<p>Vos tests doivent suivre. RÃ©Ã©crivez-les dans le langage du domaine :</p>
<p>Avant :</p>
<pre data-lang="elixir"><code>test "create registration decrements available slots" do
  event = create_event(%{max_attendees: 3})
  register_user(event.id, user.id)
  assert get_event(event.id).available_slots == 2
end</code></pre>
<p>AprÃ¨s :</p>
<pre data-lang="elixir"><code>test "inscrire un membre diminue le nombre de places" do
  seance = programmer_seance("SoirÃ©e Polar", creneau, lieu, 3)
  inscrire_membre(seance.id, marie.id)
  assert places_restantes(seance.id) == 2
end

test "impossible d'inscrire quand la sÃ©ance est complÃ¨te" do
  seance = programmer_seance("SoirÃ©e Polar", creneau, lieu, 1)
  inscrire_membre(seance.id, marie.id)
  assert {:error, :seance_complete} = inscrire_membre(seance.id, jean.id)
end

test "annuler une sÃ©ance publie un Ã©vÃ©nement avec tous les inscrits" do
  seance = programmer_seance("SoirÃ©e Polar", creneau, lieu, 20)
  inscrire_membre(seance.id, marie.id)
  inscrire_membre(seance.id, jean.id)

  annuler_seance(seance.id, "Mauvais temps")

  assert_event_published({:seance_annulee, %{
    inscrits: [marie.id, jean.id],
    raison: "Mauvais temps"
  }})
end</code></pre>
<h3>Ce que vous devez remarquer</h3>
<p>Les tests <strong>se lisent comme des scÃ©narios de la vraie vie</strong>. Quelqu'un qui ne connaÃ®t pas le code pourrait lire le test et comprendre ce qui est vÃ©rifiÃ©. C'est le signe que votre code parle la langue du domaine.</p>
<p>Le gÃ©rant du club pourrait relire ces tests et dire "oui, c'est bien comme Ã§a que Ã§a devrait marcher". Essayez avec les vÃ´tres â€” si vous devez expliquer ce que le test fait, c'est que les noms ne sont pas assez clairs.</p>
<hr>
<div class="step-header" id="m10-jour7"><span class="step-number">7</span><h2>Le bilan et le nouveau vocabulaire</h2></div>
<h3>Les mots de la semaine</h3>
<table>
<thead>
<tr>
<th>Ce que vous dites</th>
<th>Le vrai nom</th>
<th>Ce que Ã§a signifie</th>
</tr>
</thead>
<tbody>
<tr>
<td>"Dictionnaire du gÃ©rant"</td>
<td><strong>Langage omniprÃ©sent</strong> (Ubiquitous Language)</td>
<td>Le vocabulaire partagÃ© entre les utilisateurs et le code</td>
</tr>
<tr>
<td>"Grappe de choses qui vont ensemble"</td>
<td><strong>AgrÃ©gat</strong> (Aggregate)</td>
<td>Un ensemble d'objets traitÃ©s comme un tout</td>
</tr>
<tr>
<td>"La chose principale de la grappe"</td>
<td><strong>Racine de l'agrÃ©gat</strong> (Aggregate Root)</td>
<td>Le point d'entrÃ©e â€” toute modification passe par elle</td>
</tr>
<tr>
<td>"Chose dÃ©finie par son contenu"</td>
<td><strong>Objet-valeur</strong> (Value Object)</td>
<td>Une donnÃ©e sans identitÃ© propre (adresse, montant, crÃ©neau)</td>
</tr>
<tr>
<td>"Chose dÃ©finie par qui elle est"</td>
<td><strong>EntitÃ©</strong> (Entity)</td>
<td>Un objet avec une identitÃ© unique (membre, sÃ©ance)</td>
</tr>
<tr>
<td>"Le code parle comme le gÃ©rant"</td>
<td><strong>Domain-Driven Design</strong> (DDD)</td>
<td>Concevoir le logiciel Ã  partir du langage et des rÃ¨gles du mÃ©tier</td>
</tr>
</tbody>
</table>
<h3>Ce que vous faites depuis le dÃ©but, c'est du DDD</h3>
<p>Le Domain-Driven Design a Ã©tÃ© formalisÃ© par Eric Evans en 2003. C'est une approche qui dit : le code doit Ãªtre organisÃ© autour du <strong>mÃ©tier</strong> (le domaine), pas autour de la technique. Les modules dÃ©coupent par responsabilitÃ© mÃ©tier. Les interfaces parlent le langage des utilisateurs. Les invariants expriment les rÃ¨gles mÃ©tier.</p>
<p>Vous le faites depuis le Module 1. Vous ne le saviez simplement pas.</p>
<h3>La structure interne d'un module, maintenant</h3>
<pre><code>MODULE : RÃ©unions
â”‚
â”œâ”€â”€ Interface (fonctions publiques)
â”‚   â”œâ”€â”€ programmer_seance(titre, crÃ©neau, lieu, places)
â”‚   â”œâ”€â”€ inscrire_membre(seance_id, membre_id)
â”‚   â”œâ”€â”€ desinscrire_membre(seance_id, membre_id)
â”‚   â””â”€â”€ annuler_seance(seance_id, raison)
â”‚
â”œâ”€â”€ AgrÃ©gat : SÃ©ance
â”‚   â”œâ”€â”€ Racine : SÃ©ance (titre, crÃ©neau, lieu, places, statut)
â”‚   â”œâ”€â”€ RattachÃ©s : Inscription (membre, date, statut paiement)
â”‚   â”œâ”€â”€ RattachÃ©s : Liste d'attente (membre, position)
â”‚   â””â”€â”€ Invariants :
â”‚       â”œâ”€â”€ inscrits â‰¤ places
â”‚       â”œâ”€â”€ pas de double inscription
â”‚       â””â”€â”€ sÃ©ance annulÃ©e = plus d'inscriptions
â”‚
â”œâ”€â”€ Objets-valeur
â”‚   â”œâ”€â”€ CrÃ©neau (date, heure dÃ©but, heure fin)
â”‚   â”œâ”€â”€ Adresse (rue, ville, code postal)
â”‚   â””â”€â”€ Montant (valeur, devise)
â”‚
â””â”€â”€ Ã‰vÃ©nements publiÃ©s
    â”œâ”€â”€ {:seance_programmee, ...}
    â”œâ”€â”€ {:membre_inscrit, ...}
    â”œâ”€â”€ {:membre_desinscrit, ...}
    â””â”€â”€ {:seance_annulee, ...}</code></pre>
<p>C'est propre. C'est lisible. Et surtout â€” c'est comprÃ©hensible par quelqu'un qui n'a jamais vu une ligne de code.</p>
<hr>
<h2 id="m10-suite">La suite</h2>
<p>Votre code parle le langage du mÃ©tier. Vos modules sont dÃ©coupÃ©s par domaine. Vos agrÃ©gats protÃ¨gent vos invariants. Mais il y a un dernier problÃ¨me : quand le projet grandit, certains agrÃ©gats deviennent Ã©normes. La sÃ©ance gÃ¨re les inscriptions, la liste d'attente, l'annulation, les statistiques...</p>
<p>Le Module 11 va vous apprendre Ã  faire en sorte que les invariants soient <strong>protÃ©gÃ©s dans le code lui-mÃªme</strong>, pas juste dans vos tests. Et les outils d'Elixir â€” les processus et les arbres de supervision â€” vont rendre Ã§a Ã©tonnamment naturel.</p>

      </div>
    </main>
    <button class="back-to-top" aria-label="Retour en haut">â†‘</button>
  </div>
  <script src="nav.js"></script>
  <script src="app.js"></script>
</body>
</html>
